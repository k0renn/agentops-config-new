allowed_paths:
  - app/**
  - components/**
  - providers/**
  - hooks/**
  - lib/**
  - convex/**
  - middleware.ts
  - package.json
  - package-lock.json
  - tsconfig.json
  - tailwind.config.ts
  - postcss.config.js
  - .eslintrc.json
  - components.json
  - README.md
canonical_service_type:
  chosen: Backend-for-Frontend (BFF)
enforcement:
  - 'All Convex mutations/actions that require a user must call ctx.auth.getUserIdentity() and fail if absent (evidence: convex/users.ts, convex/groups.ts, convex/posts.ts).'
  - 'Inbound webhook routes must use stripe-signature header and STRIPE_WEBHOOK_SECRET verification before state changes (evidence: convex/http.ts, convex/stripe.ts).'
  - 'Route access is protected by default via Clerk authMiddleware matcher; changes require explicit review (evidence: middleware.ts).'
  - 'Schema/table changes must be reflected only in convex/schema.ts and accessed via generated API bindings (@/convex/_generated/api) (evidence: convex/schema.ts, app/(homepage)/page.tsx).'
  - 'Convex boundary: validate inputs with convex/values and enforce auth via ctx.auth.getUserIdentity() (evidence: convex/posts.ts, convex/groups.ts).'
  - 'Frontend boundary: do not reference server secrets in app/ or components/; use env vars only in server-side Convex actions (evidence: convex/stripe.ts).'
  - 'Dependency boundary: new dependencies must be justified; keep lockfile updated and committed (evidence: package.json, package-lock.json).'
  - All Convex mutations/actions that require a user must call ctx.auth.getUserIdentity() and fail if absent (see convex/users.ts, convex/groups.ts, convex/posts.ts).
  - Inbound webhook routes must use stripe-signature header and STRIPE_WEBHOOK_SECRET verification before state changes (convex/http.ts -> internal.stripe.fulfill in convex/stripe.ts).
  - Route access is protected by default via Clerk authMiddleware matcher; changes require explicit review (middleware.ts).
  - Schema/table changes must be reflected only in convex/schema.ts and accessed via generated API bindings (@/convex/_generated/api).
  - 'Convex boundary: all mutations/actions must validate inputs with convex/values and enforce auth via ctx.auth.getUserIdentity().'
  - 'Webhook boundary: only expose routes via convex/http.ts; verify stripe-signature before processing.'
  - 'Frontend boundary: do not reference server secrets in app/ or components/; use env vars only in server-side Convex actions.'
  - 'Dependency boundary: new dependencies must be justified; keep lockfile updated and committed.'
forbidden_responsibilities:
  - evidence_paths:
      - middleware.ts
      - providers/convex-client-provider.tsx
      - convex/auth.config.ts
    responsibility: Owning identity provider implementation (user auth, MFA, session issuance)
    title: Owning identity provider implementation (user auth, MFA, session issuance)
  - evidence_paths:
      - middleware.ts
      - providers/convex-client-provider.tsx
      - package.json
    responsibility: Owning authentication credentials (password storage, credential verification, custom session token minting)
    title: Owning authentication credentials (password storage, credential verification, custom session token minting)
  - evidence_paths:
      - convex/stripe.ts
      - convex/http.ts
      - package.json
    responsibility: Owning payment processor / card vault (PCI storage/processing)
    title: Owning payment processor / card vault (PCI storage/processing)
  - evidence_paths:
      - convex/schema.ts
      - convex/README.md
      - package.json
    responsibility: Operating a standalone database or database server administration outside Convex
    title: Operating a standalone database or database server administration outside Convex
hard_prohibitions:
  - Do not add custom credential storage, password handling, or session token minting; authentication is delegated to Clerk.
  - Do not store or log Stripe secrets, webhook secrets, or any API keys in the repository; use environment variables only (e.g., NEXT_STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET).
  - Do not bypass Stripe webhook signature verification for subscription fulfillment.
  - Do not implement direct database server management; data persistence is via Convex tables/schema only.
  - Do not add alternative auth providers or custom credential auth; authentication remains delegated to Clerk.
  - Do not process or store raw payment card data; payments remain delegated to Stripe.
  - Do not introduce a second persistence layer (SQL/NoSQL) without explicit governance approval; persistence remains in Convex tables.
  - Do not add unauthenticated state-changing Convex mutations/actions; all writes require ctx.auth.getUserIdentity().
  - Do not accept external webhooks without signature verification and strict parsing/bounds.
owned_responsibilities:
  - evidence_paths:
      - app/layout.tsx
      - app/(homepage)/page.tsx
      - app/[groupId]/page.tsx
    responsibility: Next.js application routing, layouts, and UI rendering (App Router)
    title: Next.js application routing, layouts, and UI rendering (App Router)
  - evidence_paths:
      - convex/schema.ts
      - convex/groups.ts
      - convex/posts.ts
    responsibility: Backend data model and business operations via Convex queries/mutations (domain persistence)
    title: Backend data model and business operations via Convex queries/mutations (domain persistence)
  - evidence_paths:
      - middleware.ts
      - providers/convex-client-provider.tsx
      - convex/auth.config.ts
    responsibility: Authentication integration and route protection using Clerk (delegated identity provider)
    title: Authentication integration and route protection using Clerk (delegated identity provider)
  - evidence_paths:
      - convex/stripe.ts
      - convex/http.ts
      - app/create/page.tsx
    responsibility: Subscription checkout initiation and Stripe webhook fulfillment handling (delegated payment processor)
    title: Subscription checkout initiation and Stripe webhook fulfillment handling (delegated payment processor)
  - evidence_paths:
      - hooks/use-api-mutation.ts
      - app/(homepage)/page.tsx
      - app/[groupId]/page.tsx
    responsibility: BFF data access orchestration via Convex client hooks (queries/mutations/actions)
    title: BFF data access orchestration via Convex client hooks (queries/mutations/actions)
  - evidence_paths:
      - convex/users.ts
      - convex/comments.ts
      - convex/groups.ts
    responsibility: Identity-aware access checks at backend boundary using Convex auth context
    title: Identity-aware access checks at backend boundary using Convex auth context
  - evidence_paths:
      - middleware.ts
      - providers/convex-client-provider.tsx
      - convex/auth.config.ts
    responsibility: Authentication integration and route protection using Clerk
    title: Authentication integration and route protection using Clerk
  - evidence_paths:
      - convex/stripe.ts
      - convex/http.ts
      - app/create/page.tsx
    responsibility: Subscription checkout initiation and Stripe webhook fulfillment handling
    title: Subscription checkout initiation and Stripe webhook fulfillment handling
service:
  id: k0renn/AcademiX
  repo: k0renn/AcademiX
  source_of_truth: DATA.repoScan
team:
  base_policy: org-defaults
  name: AcademiX team
team_guidelines:
  cicd:
    - 'Run lint via next lint (extends next/core-web-vitals) (evidence: package.json, .eslintrc.json).'
    - 'Ensure TypeScript compile/typecheck passes under strict mode (evidence: tsconfig.json, convex/tsconfig.json).'
    - 'Keep Node runtime compatibility aligned with repo requirement (Node 14.x) (evidence: README.md).'
    - 'Before merging: ensure Next.js build succeeds and Convex functions typecheck (evidence: package.json, convex/tsconfig.json).'
    - Run lint with next lint (extends next/core-web-vitals).
    - TypeScript must typecheck under strict mode.
    - Maintain runtime compatibility with repository requirement (Node 14.x).
    - 'Before merging: ensure Next.js build succeeds and Convex functions typecheck (convex/tsconfig.json strict).'
    - If GitHub Actions workflows are added, require checks to pass before merge.
  dependencies:
    - 'Use Convex React bindings and generated API imports (@/convex/_generated/api) (evidence: app/(homepage)/page.tsx, app/[groupId]/page.tsx).'
    - 'Use Clerk Next.js SDK for auth in frontend/middleware (@clerk/nextjs) (evidence: middleware.ts, providers/convex-client-provider.tsx).'
    - 'Use Stripe SDK only within server-side Convex actions where secrets are required (evidence: convex/stripe.ts).'
    - 'UI primitives should follow Radix + shadcn patterns already present in components/ui/* (evidence: components/ui/button.tsx, components.json).'
    - 'Do not add a second auth provider; authentication remains Clerk (evidence: convex/auth.config.ts).'
    - 'Do not add a second database/persistence layer; persistence remains Convex tables/schema unless explicitly approved (evidence: convex/schema.ts).'
    - Use Convex React bindings (convex/react) and generated API imports (@/convex/_generated/api).
    - Use Clerk Next.js SDK (@clerk/nextjs) for auth integration in UI/middleware.
    - Use Stripe SDK only in server-side Convex actions where secrets are required.
    - UI primitives prefer existing Radix + shadcn patterns in components/ui/*.
    - Do not add a second auth provider; Clerk remains the delegated auth provider.
    - Do not add a second persistence layer; persistence remains in Convex tables/schema unless explicitly approved.
  general:
    - 'Follow Next.js App Router conventions: app/ for routes/layouts and components/ for shared UI (evidence: app/layout.tsx, app/(homepage)/page.tsx).'
    - 'Treat Convex functions as the backend boundary; UI should call generated APIs (api.*) rather than duplicating backend logic (evidence: convex/*, app/[groupId]/page.tsx).'
    - 'Keep business/data mutations in convex/; UI components should only orchestrate by invoking mutations/actions (evidence: convex/posts.ts, convex/groups.ts).'
    - 'Prefer server-side enforcement for access control; client-side checks are UX only (evidence: convex/users.ts, middleware.ts).'
    - 'Repository-first governance: implement only what the codebase indicates is needed (evidence: .claude/CLAUDE.md, .cursor/rules.md).'
    - 'Follow Next.js App Router conventions: app/ for routes/layouts; components/ for shared UI; convex/ for backend functions.'
    - Treat Convex functions as the backend boundary; UI calls generated APIs (api.*) rather than duplicating backend data logic.
    - Keep business/data mutations in convex/; UI components should only invoke mutations/actions (no embedded write logic).
    - Prefer server-side enforcement for access control; client-side checks are UX only.
    - 'Repository-first governance: implement only what the codebase indicates is needed.'
  naming_formatting:
    - 'React components: PascalCase exports; files generally kebab-case or lowercase under components/ (evidence: components/navbar/index.tsx, components/about-side.tsx).'
    - 'Convex functions: export const <name> = query|mutation|action(...) with verb-first naming (evidence: convex/users.ts, convex/posts.ts, convex/groups.ts).'
    - 'Use TypeScript strict mode; keep types explicit at boundaries (evidence: tsconfig.json, convex/tsconfig.json).'
    - 'React components: PascalCase exports; filenames typically lowercase or kebab-case under components/.'
    - 'Convex functions: export const <name> = query|mutation|action(...) with clear verb naming (list/create/update/remove/add).'
    - 'TypeScript strict mode: keep types explicit at boundaries (e.g., Convex Id/Doc).'
  security:
    - 'All authenticated operations in convex/ must check ctx.auth.getUserIdentity() before accessing user-scoped data (evidence: convex/users.ts, convex/comments.ts).'
    - 'Use Convex indexes for user lookups (e.g., users.by_token, users.by_email) and never trust client-provided user identifiers (evidence: convex/schema.ts, convex/users.ts).'
    - 'Stripe webhooks must validate stripe-signature and STRIPE_WEBHOOK_SECRET before mutating state (evidence: convex/http.ts, convex/stripe.ts).'
    - 'Do not widen public routes in middleware without explicit review; default is protect-all (evidence: middleware.ts).'
    - 'Never commit secrets; use environment variables for NEXT_STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET, etc. (evidence: convex/stripe.ts).'
    - All authenticated Convex operations must check ctx.auth.getUserIdentity() before user-scoped access or state changes.
    - Do not trust client-provided identifiers; derive user identity from auth context and lookups via indexes (e.g., users.by_token).
    - Stripe webhooks must validate stripe-signature using STRIPE_WEBHOOK_SECRET before mutating state.
    - Do not widen public routes in middleware without explicit review; default is protect-all.
    - Never commit secrets; use environment variables (e.g., NEXT_STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET).
additional_context: "---\nFILE: .claude/CLAUDE.md\n---\n# Service Contract — k0renn/AcademiX\n\nYou are working inside a **strictly-scoped backend service**.\n\nTeam: AcademiX team\nBase policy: org-defaults\n\nCanonical service type: **Backend-for-Frontend (BFF)**  \nSource of truth: DATA.repoScan\n\n---\n\n## ✅ Owned Responsibilities\n\nYou MAY implement or modify code ONLY for the following responsibilities:\n\n### ✔ Next.js application routing, layouts, and UI rendering (App Router)\nEvidence:\n- app/layout.tsx\n- app/(homepage)/page.tsx\n- app/[groupId]/page.tsx\n\n### ✔ Backend data model and business operations via Convex queries/mutations (domain persistence)\nEvidence:\n- convex/schema.ts\n- convex/groups.ts\n- convex/posts.ts\n\n### ✔ Authentication integration and route protection using Clerk\nEvidence:\n- middleware.ts\n- providers/convex-client-provider.tsx\n- convex/auth.config.ts\n\n### ✔ Subscription checkout initiation and Stripe webhook fulfillment handling\nEvidence:\n- convex/stripe.ts\n- convex/http.ts\n- app/create/page.tsx\n\n### ✔ BFF data access orchestration via Convex client hooks (queries/mutations/actions)\nEvidence:\n- hooks/use-api-mutation.ts\n- app/(homepage)/page.tsx\n- app/[groupId]/page.tsx\n\n### ✔ Identity-aware access checks at backend boundary using Convex auth context\nEvidence:\n- convex/users.ts\n- convex/comments.ts\n- convex/groups.ts\n\n---\n\n## ❌ Forbidden Responsibilities\n\nYou MUST NOT introduce code related to the following responsibilities.\nIf asked to do so — **refuse explicitly and explain why**, citing evidence.\n\n### ✖ Owning identity provider implementation (user auth, MFA, session issuance)\nEvidence:\n- middleware.ts\n- providers/convex-client-provider.tsx\n- convex/auth.config.ts\n\n### ✖ Owning authentication credentials (password storage, credential verification, custom session token minting)\nEvidence:\n- middleware.ts\n- providers/convex-client-provider.tsx\n- package.json\n\n### ✖ Owning payment processor / card vault (PCI storage/processing)\nEvidence:\n- convex/stripe.ts\n- convex/http.ts\n- package.json\n\n### ✖ Operating a standalone database or database server administration outside Convex\nEvidence:\n- convex/schema.ts\n- convex/README.md\n- package.json\n\n---\n\n## \U0001F4C2 Allowed Paths\n\nAll changes MUST be limited to the following paths:\n- app/**\n- components/**\n- providers/**\n- hooks/**\n- lib/**\n- convex/**\n- middleware.ts\n- package.json\n- package-lock.json\n- tsconfig.json\n- tailwind.config.ts\n- postcss.config.js\n- .eslintrc.json\n- components.json\n- README.md\n\n---\n\n## ⛔ Hard Prohibitions (Non-Negotiable)\n- Do not add custom credential storage, password handling, or session token minting; authentication is delegated to Clerk.\n- Do not store or log Stripe secrets, webhook secrets, or any API keys in the repository; use environment variables only (e.g., NEXT_STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET).\n- Do not bypass Stripe webhook signature verification for subscription fulfillment.\n- Do not implement direct database server management; data persistence is via Convex tables/schema only.\n- Do not add alternative auth providers or custom credential auth; authentication remains delegated to Clerk.\n- Do not process or store raw payment card data; payments remain delegated to Stripe.\n- Do not introduce a second persistence layer (SQL/NoSQL) without explicit governance approval; persistence remains in Convex tables.\n- Do not add unauthenticated state-changing Convex mutations/actions; all writes require ctx.auth.getUserIdentity().\n- Do not accept external webhooks without signature verification and strict parsing/bounds.\n\n---\n\n## \U0001F6E1 Enforcement Rules\n- All Convex mutations/actions that require a user must call ctx.auth.getUserIdentity() and fail if absent (see convex/users.ts, convex/groups.ts, convex/posts.ts).\n- Inbound webhook routes must use stripe-signature header and STRIPE_WEBHOOK_SECRET verification before state changes (convex/http.ts -> internal.stripe.fulfill in convex/stripe.ts).\n- Route access is protected by default via Clerk authMiddleware matcher; changes require explicit review (middleware.ts).\n- Schema/table changes must be reflected only in convex/schema.ts and accessed via generated API bindings (@/convex/_generated/api).\n- Convex boundary: all mutations/actions must validate inputs with convex/values and enforce auth via ctx.auth.getUserIdentity().\n- Webhook boundary: only expose routes via convex/http.ts; verify stripe-signature before processing.\n- Frontend boundary: do not reference server secrets in app/ or components/; use env vars only in server-side Convex actions.\n- Dependency boundary: new dependencies must be justified; keep lockfile updated and committed.\n\n---\n\n## \U0001F465 Team Coding Guidelines\n\n### General\n- Follow Next.js App Router conventions: app/ for routes/layouts, components/ for shared UI, convex/ for backend functions.\n- Treat Convex functions as the backend boundary; UI should call generated APIs (api.*) rather than duplicating data logic.\n- Keep business/data mutations in convex/; avoid embedding write logic in UI components beyond invoking mutations/actions.\n- Prefer small, composable React components; colocate route-specific components under app/**/_components when appropriate.\n- Follow repository-first governance: implement only what the codebase indicates is needed.\n- Keep UI concerns in app/ and components/; keep data access and business rules in convex/.\n- Prefer server-side enforcement for access control; client-side checks are UX only.\n\n### Naming & Formatting\n- React components: PascalCase exports; files generally kebab-case or lowercase under components/.\n- Convex functions: export const <name> = query|mutation|action(...) with clear verb naming (list/create/update/remove/add).\n- Use TypeScript strict mode; keep types explicit at boundaries (Convex Id/Doc types).\n- Keep route segments under app/ aligned with Next.js App Router conventions.\n\n### Dependencies\n- Use Convex React bindings (convex/react) and generated API imports (@/convex/_generated/api).\n- Use Clerk Next.js SDK for auth in frontend/middleware (@clerk/nextjs).\n- Use Stripe SDK only within server-side Convex actions where secrets are required (stripe secret key).\n- UI primitives should prefer Radix + shadcn patterns already present in components/ui/*.\n- Do not add a second auth provider; authentication remains Clerk.\n- Do not add a second database/persistence layer; persistence remains Convex tables/schema unless explicitly approved.\n\n### Security\n- All authenticated operations in convex/ must check ctx.auth.getUserIdentity() before accessing user-scoped data.\n- Use Convex indexes for user lookups (e.g., users.by_token, users.by_email) and never trust client-provided user identifiers.\n- Stripe webhooks must validate stripe-signature and STRIPE_WEBHOOK_SECRET before mutating state.\n- Do not widen public routes in middleware without explicit review; default is protect-all.\n- Never commit secrets; use environment variables for NEXT_STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET, etc.\n\n### CI/CD & Repo Hygiene\n- Run lint via next lint (extends next/core-web-vitals).\n- Ensure TypeScript compile/typecheck passes under strict mode.\n- Keep Node runtime compatibility aligned with repo requirement (Node 14.x per README.md).\n- Before merging: ensure Next.js build succeeds and Convex functions typecheck (convex/tsconfig.json strict).\n- If GitHub Actions workflows are added, require checks to pass before merge.\n\n---\n\n## Final Rule\n\nIf a request:\n- Exceeds the service scope\n- Violates team guidelines\n- Introduces forbidden responsibilities\n\n**Refuse clearly, explain briefly, and cite evidence paths.**\n\n---\nFILE: .cursor/rules.md\n---\n# Cursor Rules — k0renn/AcademiX\n\n## Operating Constraints (Read First)\n- MUST align changes with the **Owned Responsibilities** below.\n- MUST NOT implement anything in **Forbidden Responsibilities**.\n- MUST obey **Enforcement**, **Allowed Paths**, and **Hard Prohibitions**.\n\n## Architecture (Source of Truth)\n- Source of truth: DATA.repoScan\n\n## Canonical Service Type (Choose Exactly One)\n- **Backend-for-Frontend (BFF)**\n\n## Owned Responsibilities (Allowed)\n1. Next.js application routing, layouts, and UI rendering (App Router)\n   - Evidence: app/layout.tsx\n   - Evidence: app/(homepage)/page.tsx\n   - Evidence: app/[groupId]/page.tsx\n1. Backend data model and business operations via Convex queries/mutations (domain persistence)\n   - Evidence: convex/schema.ts\n   - Evidence: convex/groups.ts\n   - Evidence: convex/posts.ts\n1. Authentication integration and route protection using Clerk\n   - Evidence: middleware.ts\n   - Evidence: providers/convex-client-provider.tsx\n   - Evidence: convex/auth.config.ts\n1. Subscription checkout initiation and Stripe webhook fulfillment handling\n   - Evidence: convex/stripe.ts\n   - Evidence: convex/http.ts\n   - Evidence: app/create/page.tsx\n1. BFF data access orchestration via Convex client hooks (queries/mutations/actions)\n   - Evidence: hooks/use-api-mutation.ts\n   - Evidence: app/(homepage)/page.tsx\n   - Evidence: app/[groupId]/page.tsx\n1. Identity-aware access checks at backend boundary using Convex auth context\n   - Evidence: convex/users.ts\n   - Evidence: convex/comments.ts\n   - Evidence: convex/groups.ts\n\n## Forbidden Responsibilities (Prohibited)\n1. Owning identity provider implementation (user auth, MFA, session issuance)\n   - Evidence: middleware.ts\n   - Evidence: providers/convex-client-provider.tsx\n   - Evidence: convex/auth.config.ts\n1. Owning authentication credentials (password storage, credential verification, custom session token minting)\n   - Evidence: middleware.ts\n   - Evidence: providers/convex-client-provider.tsx\n   - Evidence: package.json\n1. Owning payment processor / card vault (PCI storage/processing)\n   - Evidence: convex/stripe.ts\n   - Evidence: convex/http.ts\n   - Evidence: package.json\n1. Operating a standalone database or database server administration outside Convex\n   - Evidence: convex/schema.ts\n   - Evidence: convex/README.md\n   - Evidence: package.json\n\n## Enforcement (Mandatory)\n- MUST: All Convex mutations/actions that require a user must call ctx.auth.getUserIdentity() and fail if absent (see convex/users.ts, convex/groups.ts, convex/posts.ts).\n- MUST: Inbound webhook routes must use stripe-signature header and STRIPE_WEBHOOK_SECRET verification before state changes (convex/http.ts -> internal.stripe.fulfill in convex/stripe.ts).\n- MUST: Route access is protected by default via Clerk authMiddleware matcher; changes require explicit review (middleware.ts).\n- MUST: Schema/table changes must be reflected only in convex/schema.ts and accessed via generated API bindings (@/convex/_generated/api).\n- MUST: Convex boundary: all mutations/actions must validate inputs with convex/values and enforce auth via ctx.auth.getUserIdentity().\n- MUST: Webhook boundary: only expose routes via convex/http.ts; verify stripe-signature before processing.\n- MUST: Frontend boundary: do not reference server secrets in app/ or components/; use env vars only in server-side Convex actions.\n- MUST: Dependency boundary: new dependencies must be justified; keep lockfile updated and committed.\n\n## Allowed Paths (Strict)\n- app/**\n- components/**\n- providers/**\n- hooks/**\n- lib/**\n- convex/**\n- middleware.ts\n- package.json\n- package-lock.json\n- tsconfig.json\n- tailwind.config.ts\n- postcss.config.js\n- .eslintrc.json\n- components.json\n- README.md\n\n## Hard Prohibitions (Non-Negotiable)\n- MUST NOT: Do not add custom credential storage, password handling, or session token minting; authentication is delegated to Clerk.\n- MUST NOT: Do not store or log Stripe secrets, webhook secrets, or any API keys in the repository; use environment variables only (e.g., NEXT_STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET).\n- MUST NOT: Do not bypass Stripe webhook signature verification for subscription fulfillment.\n- MUST NOT: Do not implement direct database server management; data persistence is via Convex tables/schema only.\n- MUST NOT: Do not add alternative auth providers or custom credential auth; authentication remains delegated to Clerk.\n- MUST NOT: Do not process or store raw payment card data; payments remain delegated to Stripe.\n- MUST NOT: Do not introduce a second persistence layer (SQL/NoSQL) without explicit governance approval; persistence remains in Convex tables.\n- MUST NOT: Do not add unauthenticated state-changing Convex mutations/actions; all writes require ctx.auth.getUserIdentity().\n- MUST NOT: Do not accept external webhooks without signature verification and strict parsing/bounds.\n\n---\nFILE: .github/copilot-instructions.md\n---\n# GitHub Copilot Instructions — k0renn/AcademiX\n\n## Scope\n- Source of truth: DATA.repoScan\n- Service type: **Backend-for-Frontend (BFF)**\n\n## MUST\n- Follow the **Owned Responsibilities** list.\n- Follow **Enforcement**, **Allowed Paths**, and **Hard Prohibitions**.\n\n## MUST NOT\n- Implement anything listed under **Forbidden Responsibilities**.\n\n## Owned Responsibilities (Allowed)\n1. Next.js application routing, layouts, and UI rendering (App Router)\n1. Backend data model and business operations via Convex queries/mutations (domain persistence)\n1. Authentication integration and route protection using Clerk\n1. Subscription checkout initiation and Stripe webhook fulfillment handling\n1. BFF data access orchestration via Convex client hooks (queries/mutations/actions)\n1. Identity-aware access checks at backend boundary using Convex auth context\n\n## Forbidden Responsibilities (Prohibited)\n1. Owning identity provider implementation (user auth, MFA, session issuance)\n1. Owning authentication credentials (password storage, credential verification, custom session token minting)\n1. Owning payment processor / card vault (PCI storage/processing)\n1. Operating a standalone database or database server administration outside Convex\n\n## Enforcement (Mandatory)\n- All Convex mutations/actions that require a user must call ctx.auth.getUserIdentity() and fail if absent (see convex/users.ts, convex/groups.ts, convex/posts.ts).\n- Inbound webhook routes must use stripe-signature header and STRIPE_WEBHOOK_SECRET verification before state changes (convex/http.ts -> internal.stripe.fulfill in convex/stripe.ts).\n- Route access is protected by default via Clerk authMiddleware matcher; changes require explicit review (middleware.ts).\n- Schema/table changes must be reflected only in convex/schema.ts and accessed via generated API bindings (@/convex/_generated/api).\n- Convex boundary: all mutations/actions must validate inputs with convex/values and enforce auth via ctx.auth.getUserIdentity().\n- Webhook boundary: only expose routes via convex/http.ts; verify stripe-signature before processing.\n- Frontend boundary: do not reference server secrets in app/ or components/; use env vars only in server-side Convex actions.\n- Dependency boundary: new dependencies must be justified; keep lockfile updated and committed.\n\n## Allowed Paths\n- app/**\n- components/**\n- providers/**\n- hooks/**\n- lib/**\n- convex/**\n- middleware.ts\n- package.json\n- package-lock.json\n- tsconfig.json\n- tailwind.config.ts\n- postcss.config.js\n- .eslintrc.json\n- components.json\n- README.md\n\n## Hard Prohibitions\n- Do not add custom credential storage, password handling, or session token minting; authentication is delegated to Clerk.\n- Do not store or log Stripe secrets, webhook secrets, or any API keys in the repository; use environment variables only (e.g., NEXT_STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET).\n- Do not bypass Stripe webhook signature verification for subscription fulfillment.\n- Do not implement direct database server management; data persistence is via Convex tables/schema only.\n- Do not add alternative auth providers or custom credential auth; authentication remains delegated to Clerk.\n- Do not process or store raw payment card data; payments remain delegated to Stripe.\n- Do not introduce a second persistence layer (SQL/NoSQL) without explicit governance approval; persistence remains in Convex tables.\n- Do not add unauthenticated state-changing Convex mutations/actions; all writes require ctx.auth.getUserIdentity().\n- Do not accept external webhooks without signature verification and strict parsing/bounds.\n\n---\nFILE: .windsurf/rules.md\n---\n# Windsurf Rules — k0renn/AcademiX\n\n## Quick Guardrails\n- Follow **Allowed Responsibilities**.\n- Refuse changes that add **Forbidden Responsibilities**.\n- Follow **Enforcement**, **Allowed Paths**, and **Hard Prohibitions**.\n\n## Architecture\n- Source of truth: DATA.repoScan\n\n## Canonical Service Type (Exactly One)\n- **Backend-for-Frontend (BFF)**\n\n## Owned Responsibilities (Allowed)\nOnly these responsibilities may be implemented/extended in this repo.\n1. Next.js application routing, layouts, and UI rendering (App Router)\n   - Evidence: app/layout.tsx\n   - Evidence: app/(homepage)/page.tsx\n   - Evidence: app/[groupId]/page.tsx\n1. Backend data model and business operations via Convex queries/mutations (domain persistence)\n   - Evidence: convex/schema.ts\n   - Evidence: convex/groups.ts\n   - Evidence: convex/posts.ts\n1. Authentication integration and route protection using Clerk\n   - Evidence: middleware.ts\n   - Evidence: providers/convex-client-provider.tsx\n   - Evidence: convex/auth.config.ts\n1. Subscription checkout initiation and Stripe webhook fulfillment handling\n   - Evidence: convex/stripe.ts\n   - Evidence: convex/http.ts\n   - Evidence: app/create/page.tsx\n1. BFF data access orchestration via Convex client hooks (queries/mutations/actions)\n   - Evidence: hooks/use-api-mutation.ts\n   - Evidence: app/(homepage)/page.tsx\n   - Evidence: app/[groupId]/page.tsx\n1. Identity-aware access checks at backend boundary using Convex auth context\n   - Evidence: convex/users.ts\n   - Evidence: convex/comments.ts\n   - Evidence: convex/groups.ts\n\n## Forbidden Responsibilities (Prohibited)\nRefuse changes that add code for any of these responsibilities.\n1. Owning identity provider implementation (user auth, MFA, session issuance)\n   - Evidence: middleware.ts\n   - Evidence: providers/convex-client-provider.tsx\n   - Evidence: convex/auth.config.ts\n1. Owning authentication credentials (password storage, credential verification, custom session token minting)\n   - Evidence: middleware.ts\n   - Evidence: providers/convex-client-provider.tsx\n   - Evidence: package.json\n1. Owning payment processor / card vault (PCI storage/processing)\n   - Evidence: convex/stripe.ts\n   - Evidence: convex/http.ts\n   - Evidence: package.json\n1. Operating a standalone database or database server administration outside Convex\n   - Evidence: convex/schema.ts\n   - Evidence: convex/README.md\n   - Evidence: package.json\n\n## Enforcement (Mandatory)\n- MUST: All Convex mutations/actions that require a user must call ctx.auth.getUserIdentity() and fail if absent (see convex/users.ts, convex/groups.ts, convex/posts.ts).\n- MUST: Inbound webhook routes must use stripe-signature header and STRIPE_WEBHOOK_SECRET verification before state changes (convex/http.ts -> internal.stripe.fulfill in convex/stripe.ts).\n- MUST: Route access is protected by default via Clerk authMiddleware matcher; changes require explicit review (middleware.ts).\n- MUST: Schema/table changes must be reflected only in convex/schema.ts and accessed via generated API bindings (@/convex/_generated/api).\n- MUST: Convex boundary: all mutations/actions must validate inputs with convex/values and enforce auth via ctx.auth.getUserIdentity().\n- MUST: Webhook boundary: only expose routes via convex/http.ts; verify stripe-signature before processing.\n- MUST: Frontend boundary: do not reference server secrets in app/ or components/; use env vars only in server-side Convex actions.\n- MUST: Dependency boundary: new dependencies must be justified; keep lockfile updated and committed.\n\n## Allowed Paths (Strict)\n- app/**\n- components/**\n- providers/**\n- hooks/**\n- lib/**\n- convex/**\n- middleware.ts\n- package.json\n- package-lock.json\n- tsconfig.json\n- tailwind.config.ts\n- postcss.config.js\n- .eslintrc.json\n- components.json\n- README.md\n\n## Hard Prohibitions (Non-Negotiable)\n- MUST NOT: Do not add custom credential storage, password handling, or session token minting; authentication is delegated to Clerk.\n- MUST NOT: Do not store or log Stripe secrets, webhook secrets, or any API keys in the repository; use environment variables only (e.g., NEXT_STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET).\n- MUST NOT: Do not bypass Stripe webhook signature verification for subscription fulfillment.\n- MUST NOT: Do not implement direct database server management; data persistence is via Convex tables/schema only.\n- MUST NOT: Do not add alternative auth providers or custom credential auth; authentication remains delegated to Clerk.\n- MUST NOT: Do not process or store raw payment card data; payments remain delegated to Stripe.\n- MUST NOT: Do not introduce a second persistence layer (SQL/NoSQL) without explicit governance approval; persistence remains in Convex tables.\n- MUST NOT: Do not add unauthenticated state-changing Convex mutations/actions; all writes require ctx.auth.getUserIdentity().\n- MUST NOT: Do not accept external webhooks without signature verification and strict parsing/bounds."
agentops_metadata:
  doc_assets:
    pdf: 0
    doc: 0
    text: 6
  doc_assets_note: This project includes documentation assets in the repo (pdf=0, doc/docx=0, text=6). Consider them when relevant.
